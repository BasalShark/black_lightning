<% content_for :head do %>
<%= stylesheet_link_tag "admin/dashboard", media: "all" %>
<% end %>

<%# show an alert if the user hasn't filled in their name or phone number %>
<% if !current_user.name? %>
<div class="container-fluid">
  <div class="alert alert-info alert-dismissible fade show">
    <i class="fa fa-exclamation-sign fa-large" aria-hidden=”true”></i>
    You haven't set your name yet. Please click <%= link_to 'here', edit_admin_user_path(current_user) %>.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
</div>
<% elsif !(current_user.phone_number) || current_user.phone_number.empty? %>
<div class="alert-container">
  <div class="alert alert-info alert-dismissible fade show">
    <i class="fa fa-exclamation-sign fa-large" aria-hidden=”true”></i>
    You haven't set your phone number yet. Please click <%= link_to 'here', edit_admin_user_path(current_user) %>.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
</div>
<% end %>

<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">Bedlam Dashboard</h1>
      </div><!-- /.col -->
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item active">Home</li>
        </ol>
      </div><!-- /.col -->
    </div><!-- /.row -->
    <div class="row"> <% if can? :manage, :jobs %>
      <% unless delayed_job_running? then %>
      <div class="alert alert-error">
        <strong>Oh Dear</strong>
        <p>
          The DelayedJob daemon doesn't seem to be running. It may have
          crashed (again).
        </p>
      </div>
      <% end %>

      <% if delayed_jobs(:failed).count > 0 then %>
      <div class="alert alert-error">
        <strong>Stop. This is important</strong>
        <p>
          A DelayedJob has failed. Please review
          <%= link_to 'failed jobs', controller: "admin/job_control", action: "failed" %>.
        </p>
      </div>
      <% end %>
      <% end %></div>
    <div class="row">
      <div class="col-md">
        <% @user = current_user %>
        <% if @user.debt_message_suffix == "not in Debt" then @debt_card_class = "card-success" else @debt_card_class = "card-danger" %><% end %>
        <%= render 'card_widget', card_title: "Debt", card_partial: "debt_widget", card_class: @debt_card_class %>
        <%= render 'card_widget', card_title: "Opportunities", card_partial: "opportunities_widget", card_class: "" %>
      </div>
      <div class="col-md-6">
        <%= render 'card_widget', card_title: "News", card_partial: "news_widget", card_class: "" %>
        <%= render 'card_widget', card_title: "Upcoming Shows", card_partial: "shows_widget", card_class: "" %>
        <%= render 'card_widget', card_title: "Open Proposals", card_partial: "proposals_widget", card_class: "" %>
      </div>
      <div class="col-xl">
        <%= render 'card_widget', card_title: "Staffing", card_partial: "staffings_widget", card_class: "" %>
        <%= render 'card_widget', card_title: "Committee Staffing", card_partial: "committee_staffing_widget", card_class: "" %>
      </div>
    </div>
  </div><!-- /.container-fluid -->
</div>