<%= form_tag(admin_permissions_path, :method => :post) do %>

<table class="table table-hover">
  <colgroup>
    <col span="1" style="border-right: 1px solid #dddddd;">
    <col span="4">
    <col span="1" style="border-right: 1px solid #dddddd;">
    <col span="4">
    <col span="1" style="border-right: 1px solid #dddddd;">
  </colgroup>
  <thead>
    <tr>
      <th></th>
      <% @roles.each do |role| %>
        <th colspan=5><%= role.name %></th>
      <% end %>
    </tr>
    <tr>
      <th></th>
      <% @roles.each do |role| %>
        <th title="Read"  >R</th>
        <th title="Create">C</th>
        <th title="Edit"  >E</th>
        <th title="Delete">D</th>
        <th title="Manage">M</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @models.each do |model| %>
      <tr>
        <td><%= model.name %></td>

        <% @roles.each do |role| %>
          <% permission = role.permissions.where({ :subject_class => model.name }) %>
          <%= render 'permission_grid', :role => role, :model => model, :permission => permission %>
        <% end %>
      </tr>
    <% end %>
    <tr>
        <td>Misc</td>

        <% @roles.each do |role| %>
          <% permission = role.permissions.where({ :subject_class => "backend" }) %>
          <% if permission %>
            <% action_permission = permission.where(:action => "access") %>
            <% checked = action_permission.count > 0 %>
          <% end %>

          <td colspan="5">
            <%= label_tag("[#{role.name}][backend]access", "Access Backend") %>
            <%= check_box_tag "[#{role.name}][backend]access", "access", checked, :title => "Access Backend" %>
          </td>
        <% end %>
      </tr>
  </tbody>
</table>

<%= submit_tag("Update") %>

<% end %>