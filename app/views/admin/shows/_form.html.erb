<%= simple_nested_form_for [:admin, @show] do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">

    <%= f.input :name %>

    <%= f.input :tagline %>

    <%= f.input :slug %>

    <%= f.input :start_date %>

    <%= f.input :end_date %>

    <%= render :partial => "admin/shared/md_editor", :locals => { :f => f, :field => :description } %>

    <%= f.association :venue, :collection => Venue.all, :label_method => :name %>

    <%= f.input :xts_id %>

    <%= f.input :image %>

    <%= f.input :is_public if can? :make_public, @show %>

    <div class="form-horizontal">

      <h3>Team</h3>

      <% if f.object.errors[:team_members].present? then %>
      <p id="team_errors" class="alert alert-error">
          <%= f.error :team_members %>
      </p>
      <% end %>

      <%= f.simple_fields_for :team_members %>

      <% add_member_text = '<i class="icon-plus"></i> Add Team Member'.html_safe %>
      <%= f.link_to_add add_member_text, :team_members, :class => "btn" %>

    </div>

    <h3>Reviews</h3>

    <%= f.simple_fields_for :reviews %>

    <% add_review_text = '<i class="icon-plus"></i> Add Review'.html_safe %>
    <%= f.link_to_add add_review_text, :reviews, :class => "btn" %>

    <div class="gallery-form">

      <h3>Gallery</h3>

      <% if f.object.errors[:pictures].present? then %>
      <p id="picture_errors" class="alert alert-error">
          <%= f.error :pictures %>
      </p>
      <% end %>

      <%= f.simple_fields_for :pictures %>

      <br />

      <% add_photo_text = '<i class="icon-plus"></i> Add Photo'.html_safe %>
      <%= f.link_to_add add_photo_text, :pictures, :class => "btn" %>

    </div>

  </div>

  <script>
  var xts_shows = [];
    $(document).ready(function() {
        $.get('https://internal.bedlamtheatre.co.uk:8443/xts/v2/tickets/getprogramme?agents=craig:insecure', function (data) {
            $(data).find('showsummary').each(function () {
                xts_shows.push({"name": $(this).find('name').text(), "id": $(this).find('id').text()});
                console.log(xts_shows);
            });
        });
    });

    $('#show_name').keyup(function() {
        var slug = jQuery.trim($('#show_name').val()).replace(/\s+/g,'-').replace(/[^a-zA-Z0-9\-]/g,'').toLowerCase().replace(/\-{2,}/g,'-');
        $('#show_slug').val(slug);
    });
  </script>

  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to 'Cancel', admin_shows_path, :class => "btn" %>
  </div>
<% end %>
