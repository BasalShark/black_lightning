<%= simple_nested_form_for [:admin, @show] do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">

    <%= f.input :name, :wrapper => :append do %>
      <%= f.input_field :name %>
      <a class="btn xts_lookup" href="javascript:void(0);" title="Lookup show in XTS and fetch XTS ID, tagline and dates.">
        <i class="icon-search"></i>
      </a>
    <% end %>

    <%= f.input :tagline %>

    <%= f.input :slug %>

    <%= f.input :author %>

    <%= f.input :start_date %>

    <%= f.input :end_date %>

    <%= render :partial => "admin/shared/md_editor", :locals => { :f => f, :field => :description } %>

    <%= f.association :venue, :collection => Venue.all, :label_method => :name %>

    <%= f.association :season, :collection => Season.all, :label_method => :name %>

    <%= f.input :xts_id %>

    <%= f.input :image %>

    <%= f.input :is_public, boolean_style: :inline if can? :make_public, @show %>
    <script type="text/javascript">
      $('#show_is_public').parent().toggleButtons({
        width: 220,
        label: {
          enabled: "Published",
          disabled: "Private"
        },
        style: {
          enabled:  "success",
          disabled: "danger"
        }
      });
    </script>

    <div class="form-horizontal">

      <h3>Team</h3>

      <% if f.object.errors[:team_members].present? then %>
      <p id="team_errors" class="alert alert-error">
        <%= f.error :team_members %>
      </p>
      <% end %>

      <ul class="sortable">
        <%= f.fields_for :team_members, :wrapper => false %>

        <% add_member_text = '<i class="icon-plus"></i> Add Team Member'.html_safe %>
        <%= f.link_to_add add_member_text, :team_members, :class => "btn ui-state-disabled" %>
      </ul>

    </div>

    <h3>Reviews</h3>

    <%= f.simple_fields_for :reviews %>

    <% add_review_text = '<i class="icon-plus"></i> Add Review'.html_safe %>
    <%= f.link_to_add add_review_text, :reviews, :class => "btn" %>

    <div class="gallery-form">

      <h3>Gallery</h3>

      <% if f.object.errors[:pictures].present? then %>
      <p id="picture_errors" class="alert alert-error">
        <%= f.error :pictures %>
      </p>
      <% end %>

      <%= f.simple_fields_for :pictures %>

      <br />

      <% add_photo_text = '<i class="icon-plus"></i> Add Photo'.html_safe %>
      <%= f.link_to_add add_photo_text, :pictures, :class => "btn" %>

    </div>

  </div>

  <script>
    $('#show_name').keyup(function() {
        var slug = jQuery.trim($('#show_name').val()).replace(/\s+/g,'-').replace(/[^a-zA-Z0-9\-]/g,'').toLowerCase().replace(/\-{2,}/g,'-');
        $('#show_slug').val(slug);
    });
  </script>

  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to 'Cancel', admin_shows_path, :class => "btn" %>
  </div>
<% end %>
