<h1>Staffing for <%= params[:show_title] %></h1>

<%= display_block("Staffing", true) %>

<table class="table table-hover" style="table-layout: fixed;">
  <thead>
    <tr>
      <th style="width: 160px;">Date</th>

      <% @job_titles.each do |title| %>
        <th><%= title %></th>
      <% end %>
    </tr>
  </thead>

  <tbody>
    <% @staffings_hash.each do |staffing_hash| %>
      <tr>
        <td>
          <%= link_to staffing_hash[:staffing] do %>
            <%= l staffing_hash[:date], :format => :long_date_only %>
            <br />
            <%= l staffing_hash[:date], :format => :time_only %>
          <% end %>
        </td>

        <% @job_titles.each do |title| %>
          <td>
            <% job = staffing_hash[:jobs][title] %>
            <% if job %>
              <% u = job.user %>
              <% if u then %>
                <%=if can? :read, u 
		      link_to u.name_or_email, admin_user_path(u) 
		   else
		      u.name_or_email 
		   end%>
              <% else %>
                <input type="hidden" class="job_json" value="<%= job.to_json %>" >
                <% date = l staffing_hash[:date], :format => :long %>
                <%= link_to admin_sign_up_confirm_path(job), :class => "btn staffing-sign-up", :method => :put, data: { "confirm" => "Confirm Staffing",
                                                                                                                                               "detail"  => "Confirm staffing as #{job.name} for #{params[:show_title]} on #{date}",
                                                                                                                                               :job_id   => job.id
                                                                                                                                             } do %>
                  <i class="icon-edit"></i> Sign Up
                <% end %>
              <% end %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
